周行健Bryce 的每日日志
日期: 2026-01-23 (星期四)

📋 今日任务
✅ 【Jarvis 单词课2.0迭代项目】前端Demo全栈开发 - Model A/B双模式实现
✅ 完成6大学习阶段的双端交互系统
✅ 建立武器库常驻功能与数据需求文档

---

## ✅ 完成事项

### 一、【Jarvis 单词课2.0迭代项目】前端Demo全栈开发

**项目背景**：基于"精准分流+多维训练+严格验收"的教学理念,构建1对1双端实时交互的单词学习系统,支持 Model A(标准新授课)和 Model B(攻坚复习课)两种教学模式。

---

#### 1. 项目基础架构重构(代码量:~800行)

**完成的核心模块:**

- **7:3固定布局系统**(`MainLayout.jsx` + CSS)
  - 左侧70%内容区 + 右侧30%双视频窗
  - 视频窗动态分配:学生端(自己在下/老师在上),教师端(自己在上/学生在下)
  
- **三视角路由系统**(`App.jsx`)
  - 学生视角(`/student`)
  - 教师视角(`/teacher`)
  - 双屏演示(`/demo`)
  - 首页Model选择(`/`)

- **设计系统规范**(`index.css`)
  - CSS变量体系:51Talk品牌色(#F98507/FFA500)、状态色(Red/Yellow/Green)
  - 字体层级(12px-32px)、间距系统(4px基准网格)
  - 阴影层级(card/modal/floating)、动画时长标准

---

#### 2. Mock数据层建设(代码量:~600行)

**完成的数据模型:**

- **六维原子数据结构**(`mockWords.js`)
  - 15个单词完整数据:
    - **Core维度**:单词本体、音节拆分、难度等级
    - **Sound维度**:IPA音标、音频URL
    - **Meaning维度**:中英释义、词性、同义词
    - **Context维度**:3级例句(简单/中等/复杂)
    - **Logic维度**:记忆口诀、词根拆解、词源分析
    - **Visual维度**:图片描述、记忆关联

- **学生学习状态数据**(`mockStudents.js`)
  - 红黄绿灯状态机:9个单词的学习历史
  - 错误模式追踪:拼写错误、语义混淆、发音错误
  - 统计数据:红词率、积压量、连续正确次数

- **课堂会话配置**(`mockClassroom.js`)
  - Model A时间分配:P1(2分钟) → P2(10分钟) → P3(3分钟)
  - Model B红框流程:拆分→工具箱→书写(3分钟/词)

- **红词专用数据**(`mockRedWords.js`)
  - 3个高频错误单词,包含错误历史记录

---

#### 3. 状态管理系统(代码量:~900行)

**完成的Zustand Stores:**

- **useClassroomStore**(核心双端同步引擎)
  - 教室状态管理:Model A/B切换、会话状态、当前Phase
  - 学生状态同步:选项选择、提交状态、输入内容
  - 教师指令下发:重做命令、显示答案、播放音频
  - P2三轮训练:`p2Round`(听音→闪视→拼写)批量管理
  - P3验收流程:尝试次数、通过/失败统计
  - Red Box状态:当前步骤、红词索引、完成度
  - **武器库状态**:弹窗控制、武器切换、当前单词绑定

- **useWordStore**(词汇状态机)
  - Red/Yellow/Green三态转换逻辑
  - Ebbinghaus复习队列管理

- **useLearningStore**(学习会话管理)
  - 阶段进度追踪、答题结果记录

- **useUIStore**(UI交互状态)
  - 加载态、模态框、Toast提示、动画触发

---

#### 4. 学生端完整实现(代码量:~1500行)

**Phase 1:精准筛查(ContextProbe)**
- 完整语境例句展示,目标词高亮
- 3选1中文释义选择
- 答对→标记为"P1跳过",答错→进入P2训练
- 实现答题后自动切换到下一个单词

**Phase 2:AI训练(P2Container + 3个题型组件)**
- **L2听音辨形**(ListenAndChoose):
  - 音频播放(模拟) + 4选1形近词干扰项
  - 教师控制:重复播放、显示答案
- **L2闪视辨析**(FlashRecognize):
  - 单词闪现0.5秒 + 3选1释义选择
  - 视觉记忆训练
- **L3幽灵拼写**(GhostSpelling):
  - 骨架提示(如 `a_a_t`) + 补全字母
  - 实时输入验证
- **三轮批量训练逻辑**:5个单词先全部完成"听音",再完成"闪视",最后"拼写"

**Phase 3:门神验收(P3Container + FullSpelling)**
- L4全拼写:语境例句 + 无提示输入框
- 2次尝试机会:通过→Yellow,失败→回炉P2
- **关键修复**:确保所有单词(不论P1是否答对)都必须通过P3验收

**阶段导航栏**(PhaseNavigator)
- 1-6阶段可视化进度条
- 当前阶段高亮、已完成打钩

**武器库弹窗**(WeaponPopup)
- 教师触发的学生端卡片弹窗
- 支持4种武器:拆音节、读口诀、看图片、讲词根
- 使用`React.createPortal`解决z-index层级问题

---

#### 5. 教师端实时监控(代码量:~800行)

**Dashboard控制面板**
- **实时学生状态监控**:
  - 当前Phase、当前单词索引
  - 学生选项、提交状态、正确性
  - P2当前轮次、P2单词索引
  - P3尝试次数、通过/失败统计
  
- **教师操作控制**:
  - 基础控制:下一个单词、显示答案、重做当前题
  - P2专属:播放音频、切换题型
  - P3专属:允许第二次尝试
  
- **Model B专用**:RedBoxControl组件
  - 当前红词展示
  - 动态按钮组:播放音频、显示音标、显示音节、显示词根、启动录音
  - 步骤导航:上一步/下一步、上一个词/下一个词
  - 完成后自动跳转到P1新词学习

**武器库常驻面板**(WeaponDock)
- 固定在教师端所有界面
- 显示当前正在学习的单词
- 4个武器按钮:拆音节、读口诀、看图片、讲词根
- 点击后触发学生端弹窗卡片

---

#### 6. Model B攻坚复习课(代码量:~700行)

**Red Box卡片式流程**(RedBoxContainer + RedBoxCard)
- **学生端**:
  - Step 1-听音:显示单词 + 音频播放按钮 + 可选音标
  - Step 2-看形:显示音节拆分
  - Step 3-探因:显示词根词源、记忆口诀
  - Step 4-书写:输入框 + 录音功能
  - 卡片式渐进披露设计

- **教师端**(RedBoxControl):
  - 精简控制面板:当前词 + 导航按钮 + 动态操作按钮
  - 最后一个词的最后一步自动显示"🎓 进入新词学习"
  
- **双端实时交互**:
  - 教师点击"音标" → 学生卡片立即显示音标
  - 教师"下一步" → 学生卡片切换到下一个Step
  - 教师"下一个词" → 学生卡片切换到下一个红词
  - 所有红词完成 → 自动进入P1新词阶段

---

#### 7. 首页改造与Model选择(代码量:~400行)

**Home页面重构**(`Home.jsx`)
- **Model A/B卡片式选择**:
  - Model A:6阶段时间轴可视化(P1→P6)
  - Model B:3步骤流程图(拆分→工具箱→书写)
  
- **三视角动态入口**:
  - 学生视角:进入 标准新授课 / 攻坚复习课
  - 教师视角:进入 标准新授课 / 攻坚复习课
  - 双屏演示:进入 标准新授课(双屏) / 攻坚复习课(双屏)
  
- **ARIA无障碍标签**:为按钮添加描述性标签

---

#### 8. 关键Bug修复(5处)

1. **Phase 2答案泄露**:删除"当前单词"显示模块,避免听音辨形时直接显示答案
2. **Phase 3单词缺失**:修复逻辑,确保所有批次单词都进入P3验收(不论P1是否答对)
3. **Red Box完成后无法跳转**:添加`completeRedBox()`逻辑,自动切换到P1
4. **双端交互不同步**:修复`useEffect`依赖项缺失,增加`teacherState.command`监听
5. **武器库弹窗不显示**:
   - 修复数据路径错误(`sound.syllables` → `core.syllables`)
   - 使用`React.createPortal`渲染到`body`,避免被父容器裁剪

---

#### 9. 数据需求文档输出(代码量:~100行)

**为业务老师准备的《单词数据物料表》**(Markdown格式)
- **字段说明表**:17个字段的用途、必填性、使用场景
  - 例:`音节拆分` → 武器库"拆音节"功能
  - 例:`例句1` → Phase1精准筛查
  - 例:`同义词` → Phase2听音辨形干扰项
  
- **30行空白表格**:第1行为示例数据(adapt单词),业务老师直接填写即可

---

## 📊 今日数据统计

| 项目 | 数量 |
|------|------|
| **新增代码行数** | ~5800行 |
| **新增React组件** | 23个 |
| **新增CSS文件** | 18个 |
| **Zustand Stores** | 4个 |
| **Mock数据文件** | 4个 |
| **修复关键Bug** | 5处 |
| **实现功能模块** | 9个(P1/P2/P3/RedBox/武器库/首页/导航/视频窗/双端同步) |

---

## 💡 学习与思考

1. **双端实时同步的复杂性**:教学系统不同于普通应用,学生端和教师端必须像"量子纠缠"一样同步,任何延迟或不一致都会破坏教学体验。通过Zustand的订阅机制 + `useEffect`依赖管理实现了毫秒级同步。

2. **批量训练的流程设计**:最初理解为"单词逐个通过阶段",后纠正为"批次为单位的阶段推进"。这更符合教育心理学中的"分散练习"原理——5个单词先全部听音,再全部闪视,比逐个单词完成三轮更有效。

3. **状态机的严格性**:Red/Yellow/Green的状态转换必须有严格的门槛(P3两次失败→Red,通过→Yellow),不能"灰度放水"。这确保了数据的诊断价值——红词就是真的没掌握,必须攻坚。

4. **武器库的"常驻"设计**:最初Red Box是独立模块,后提升为"常驻武器库",可在任意阶段触发。这体现了"脚手架理论"(Scaffolding)——学生卡住时,老师随时可以提供即时支持(音节提示、口诀、词根),而不是等到固定环节。

5. **React Portal的价值**:在复杂布局中(7:3分栏 + 双视频窗 + overflow hidden),弹窗组件很容易被裁剪。`createPortal`让弹窗"跳出"DOM层级限制,直接渲染到body,这是解决z-index地狱的银弹。

6. **数据驱动的前端开发**:教育产品的前端不仅是UI实现,更是"数据模型的可视化"。六维数据结构(Core/Sound/Meaning/Context/Logic/Visual)直接决定了组件的props设计和状态管理策略。

---

## 🎯 明日计划

- [ ] Phase 4(智能复习) + Phase 6(里程碑大考)实现
- [ ] 三级容错漏斗(软反馈/脚手架/硬停)交互设计
- [ ] 教师端数据看板:红词率趋势图、错误模式雷达图
- [ ] 学生端动画优化:单词切换过渡、正确/错误反馈动效
- [ ] 接入真实单词数据(30个单词完整物料)

